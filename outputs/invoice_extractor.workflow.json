{
  "name": "InvoiceExtractor",
  "description": "Extract totals and supplier info from PDFs and validate against rules.",
  "nodes": [
    {
      "id": "load_pdf",
      "kind": "task",
      "tool": "pdf_reader",
      "inputs": {
        "path": "{{inputs.pdf_path}}"
      },
      "outputs": [
        "text"
      ],
      "on_error": {},
      "timeout": 30,
      "retry": 0
    },
    {
      "id": "extract_fields",
      "kind": "task",
      "tool": "regex_extract",
      "inputs": {
        "text": "{{load_pdf.text}}"
      },
      "outputs": [
        "fields"
      ],
      "on_error": {},
      "timeout": 30,
      "retry": 0
    },
    {
      "id": "validate",
      "kind": "evaluator",
      "tool": "schema_validate",
      "inputs": {
        "obj": "{{extract_fields.fields}}"
      },
      "outputs": [
        "ok"
      ],
      "on_error": {},
      "timeout": 30,
      "retry": 0
    }
  ],
  "edges": [
    {
      "from": "load_pdf",
      "to": "extract_fields",
      "when": null
    },
    {
      "from": "extract_fields",
      "to": "validate",
      "when": null
    }
  ],
  "policies": {
    "pii_redaction": false,
    "allow_network": false
  },
  "tools": [
    {
      "id": "pdf_reader",
      "type": "builtin.pdf_read",
      "config": {}
    },
    {
      "id": "regex_extract",
      "type": "builtin.regex",
      "config": {
        "patterns": {
          "total": "Total[: ]+([0-9]+\\.[0-9]{2})",
          "supplier": "Supplier[: ]+(.+)"
        }
      }
    },
    {
      "id": "schema_validate",
      "type": "builtin.schema",
      "config": {
        "schema": {
          "total": "number",
          "supplier": "string"
        }
      }
    }
  ]
}